# Dataset Organization

This directory contains scripts to organize work with dataset.

## Requirements

- [uv](https://github.com/astral-sh/uv) installed

## Prerequisites

Execute the following commands to install dependencies:
```bash
uv sync
```

## Download dataset files

You can use `download-sources.py` script to download dataset files.

### Usage
```
usage: download-sources.py [-h] [--base-url BASE_URL] [--max-concurrent MAX_CONCURRENT] [--start-year START_YEAR] [--end-year END_YEAR] [--start-month START_MONTH] [--end-month END_MONTH]
                           [--file-prefix FILE_PREFIX] [--file-extension FILE_EXTENSION] [--output-dir OUTPUT_DIR]

Download NYC taxi trip data.

options:
  -h, --help            show this help message and exit
  --base-url BASE_URL   Base URL for downloading files
  --max-concurrent MAX_CONCURRENT
                        Maximum number of concurrent downloads
  --start-year START_YEAR
                        Start year for data download
  --end-year END_YEAR   End year for data download (inclusive)
  --start-month START_MONTH
                        Start month for data download
  --end-month END_MONTH
                        End month for data download (inclusive)
  --file-prefix FILE_PREFIX
                        Prefix for downloaded files
  --file-extension FILE_EXTENSION
                        File extension for downloaded files
  --output-dir OUTPUT_DIR
                        Directory to save downloaded files
```

### Example

The following command will download files from December 2022 to January 2024 inclusive, with a maximum of 10 concurrent downloads. It will save the files in the `./data` directory. Format of the files is `{file_prefix}_{year}-{month}.{file_extension}`.

```bash
uv run download-sources.py \
    --base-url https://d37ci6vzurychx.cloudfront.net/trip-data/ \
    --start-year 2022 \
    --end-year 2024 \
    --start-month 1 \
    --end-month 12 \
    --file-prefix yellow_tripdata \
    --file-extension parquet \
    --output-dir ./data \
    --max-concurrent 10
```

## Generate report of downloaded files

This script will generate a report in HTML, Markdown or Typst format and save it to a specified file. Optionally, you can include a summary row with totals.

### Usage
```
usage: generate-index.py [-h] [--source-dir SOURCE_DIR] [--output-format {html,markdown,typst}] [--output-file OUTPUT_FILE] [--summary] [--replace-root REPLACE_ROOT]

Generate report from parquet files.

options:
  -h, --help            show this help message and exit
  --source-dir SOURCE_DIR
                        Directory containing parquet files
  --output-format {html,markdown,typst}
                        Output format: html, markdown or typst
  --output-file OUTPUT_FILE
                        Output file path
  --summary             Include summary row with totals
  --replace-root REPLACE_ROOT
                        Replace the root path with this custom base (e.g. URL)
```

### Example

The following command will generate a index file in Markdown format and save it to `./index.md` with a summary row. Additionally, it will replace the root of the links to `https://dartt0n.website.yandexcloud.net/ibd`

```bash
uv run generate-index.py \
    --output-format markdown \
    --output-file index.md \
    --replace-root https://dartt0n.website.yandexcloud.net/ibd \
    --summary
```

### Artifacts

#### HTML
The generated `index.html` file is hosted here: [data files index](https://dartt0n.website.yandexcloud.net/ibd)

#### Markdown
The following table is generated by this script:

| year      | month | size (mb)  | rows          | file                                                                                                           |
| --------- | ----- | ---------- | ------------- | -------------------------------------------------------------------------------------------------------------- |
| 2022      | 01    | 36.4       | 2463931       | [yellow_tripdata_2022-01.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2022-01.parquet) |
| 2022      | 02    | 43.5       | 2979431       | [yellow_tripdata_2022-02.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2022-02.parquet) |
| 2022      | 03    | 53.1       | 3627882       | [yellow_tripdata_2022-03.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2022-03.parquet) |
| 2022      | 04    | 52.7       | 3599920       | [yellow_tripdata_2022-04.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2022-04.parquet) |
| 2022      | 05    | 53.0       | 3588295       | [yellow_tripdata_2022-05.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2022-05.parquet) |
| 2022      | 06    | 52.8       | 3558124       | [yellow_tripdata_2022-06.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2022-06.parquet) |
| 2022      | 07    | 47.1       | 3174394       | [yellow_tripdata_2022-07.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2022-07.parquet) |
| 2022      | 08    | 47.4       | 3152677       | [yellow_tripdata_2022-08.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2022-08.parquet) |
| 2022      | 09    | 47.3       | 3183767       | [yellow_tripdata_2022-09.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2022-09.parquet) |
| 2022      | 10    | 54.4       | 3675411       | [yellow_tripdata_2022-10.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2022-10.parquet) |
| 2022      | 11    | 47.8       | 3252717       | [yellow_tripdata_2022-11.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2022-11.parquet) |
| 2022      | 12    | 51.2       | 3399549       | [yellow_tripdata_2022-12.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2022-12.parquet) |
| 2023      | 01    | 45.5       | 3066766       | [yellow_tripdata_2023-01.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2023-01.parquet) |
| 2023      | 02    | 45.5       | 2913955       | [yellow_tripdata_2023-02.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2023-02.parquet) |
| 2023      | 03    | 53.5       | 3403766       | [yellow_tripdata_2023-03.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2023-03.parquet) |
| 2023      | 04    | 51.7       | 3288250       | [yellow_tripdata_2023-04.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2023-04.parquet) |
| 2023      | 05    | 55.9       | 3513649       | [yellow_tripdata_2023-05.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2023-05.parquet) |
| 2023      | 06    | 52.5       | 3307234       | [yellow_tripdata_2023-06.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2023-06.parquet) |
| 2023      | 07    | 46.1       | 2907108       | [yellow_tripdata_2023-07.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2023-07.parquet) |
| 2023      | 08    | 45.9       | 2824209       | [yellow_tripdata_2023-08.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2023-08.parquet) |
| 2023      | 09    | 45.7       | 2846722       | [yellow_tripdata_2023-09.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2023-09.parquet) |
| 2023      | 10    | 56.3       | 3522285       | [yellow_tripdata_2023-10.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2023-10.parquet) |
| 2023      | 11    | 53.5       | 3339715       | [yellow_tripdata_2023-11.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2023-11.parquet) |
| 2023      | 12    | 54.2       | 3376567       | [yellow_tripdata_2023-12.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2023-12.parquet) |
| 2024      | 01    | 47.6       | 2964624       | [yellow_tripdata_2024-01.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2024-01.parquet) |
| 2024      | 02    | 48.0       | 3007526       | [yellow_tripdata_2024-02.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2024-02.parquet) |
| 2024      | 03    | 57.3       | 3582628       | [yellow_tripdata_2024-03.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2024-03.parquet) |
| 2024      | 04    | 56.4       | 3514289       | [yellow_tripdata_2024-04.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2024-04.parquet) |
| 2024      | 05    | 59.7       | 3723833       | [yellow_tripdata_2024-05.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2024-05.parquet) |
| 2024      | 06    | 57.1       | 3539193       | [yellow_tripdata_2024-06.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2024-06.parquet) |
| 2024      | 07    | 49.9       | 3076903       | [yellow_tripdata_2024-07.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2024-07.parquet) |
| 2024      | 08    | 48.7       | 2979183       | [yellow_tripdata_2024-08.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2024-08.parquet) |
| 2024      | 09    | 58.3       | 3633030       | [yellow_tripdata_2024-09.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2024-09.parquet) |
| 2024      | 10    | 61.4       | 3833771       | [yellow_tripdata_2024-10.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2024-10.parquet) |
| 2024      | 11    | 57.8       | 3646369       | [yellow_tripdata_2024-11.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2024-11.parquet) |
| 2024      | 12    | 58.7       | 3668371       | [yellow_tripdata_2024-12.parquet](https://dartt0n.website.yandexcloud.net/ibd/yellow_tripdata_2024-12.parquet) |
|           |       |            |               |                                                                                                                |
| **total** |       | **1853.9** | **119136044** |                                                                                                                |
